from fractions import Fraction
from cvxpy import Variable, Maximize, Minimize, Problem
import itertools
import math


# Variables globales
N = 10
K = 3
eps = 1e-10
all_sets = list(itertools.combinations(range(N), K))
S = tuple(range(K))
S_c = tuple(range(K,N))


# Funciones auxiliares
def prod(s, q):
    return math.prod([q[i] for i in s])


def p(q, i):
    return sum([prod(s, q) for s in all_sets if i in s])


# Jamie's starting point
Q = [Fraction(41464474127861950637839007398986738092367742460928714903296595501628640157823272608516023754038841516425283267673962138877946928813289635973242299480610707063320592801255906878742527095124126512713716559275553249731818693334854848131615701603489048828650377375020320765495732314303912047985419981865320798236650673322122438835208153895897134198132514257352018421299633354717932952922183152483487672589456973828534059027114911311633011996049584833894725299360293985721196225406265505500243920473745055622691723772575137064984360447877005943951915905411543324123421442562560313711820976970227230621035911293798584956993361932985751957, 33855601355365440018981898404176612957916820353833650323527659243913904588368768826002488518021780487625965139467046817108792831235112984253811141640922700611352957131814045854008775562408045120249763071320159096705755581314787904492461765861788657934789847273004016239503135842144447526893102969687284804522956956602110979868458256789583924888546729846492372388102954053028774050827018250297466784672850160125103322248661113615162677310810016673908661762982308351612154526556583021211525422418019724048419029040200103475089747004514448977718059189239509974274246756107551660850919502670615885002271302212712765057637846280568832000), Fraction(15549177797948251222505399834727798483082385773308939242053890385072605952292771178400335379060323183596433848921325046902503108849408505544092019023092859893217898760637921900445619814930350404008909628445019524995413510906885578843720073393843678924279887047192058000510300415256090771789099194627134926714825852833643462818686715762337903084127585514973374160007870849854383822874062366566881334736358774940270595934337762254973528150786522236737031072905202944272843576155228980944936327874303585140098205026642841469410457202424965866719912293044594745788694012901610676890102379315544609794545843245260477078938494767863410793, 8463900338841360004745474601044153239479205088458412580881914810978476147092192206500622129505445121906491284866761704277198207808778246063452785410230675152838239282953511463502193890602011280062440767830039774176438895328696976123115441465447164483697461818251004059875783960536111881723275742421821201130739239150527744967114564197395981222136682461623093097025738513257193512706754562574366696168212540031275830562165278403790669327702504168477165440745577087903038631639145755302881355604504931012104757260050025868772436751128612244429514797309877493568561689026887915212729875667653971250567825553178191264409461570142208000), Fraction(41464474127861950637839007398986738092367742460928714903296595501628640157823272608516023754038841516425283267673962138877946928813289635973242299480610707063320592801255906878742527095124126512713716559275553249731818693334854848131615701603489048828650377375020320765495732314303912047985419981865320798236650673322122438835208153895897134198132514257352018421299633354717932952922183152483487672589456973828534059027114911311633011996049584833894725299360293985721196225406265505500243920473745055622691723772575137064984360447877005943951915905411543324123421442562560313711820976970227230621035911293798584956993361932985751957, 16927800677682720009490949202088306478958410176916825161763829621956952294184384413001244259010890243812982569733523408554396415617556492126905570820461350305676478565907022927004387781204022560124881535660079548352877790657393952246230882930894328967394923636502008119751567921072223763446551484843642402261478478301055489934229128394791962444273364923246186194051477026514387025413509125148733392336425080062551661124330556807581338655405008336954330881491154175806077263278291510605762711209009862024209514520100051737544873502257224488859029594619754987137123378053775830425459751335307942501135651106356382528818923140284416000)]
Q = Q  + [Fraction(0)] * (N - len(Q))
Q_normalization = sum([prod(s, Q) for s in all_sets])
marginales = [p(Q, i)/Q_normalization for i in range(N)]


# Definir funciÃ³n objetivo
def counterexample_finder():
    assignments = list(range(N))

    q = {i : Variable() for i in assignments}
    q_ = {i : Variable() for i in assignments}
    
    constraints = [prod(S, q_) >= prod(S, q) + eps] \
            + [p(q_, i) >= p(q, i) + eps for i in S] \
            + [p(q_, i) + eps <= p(q, i) for i in S_c] \
            + [sum([prod(s, q) for s in all_sets]) == 1] \
            + [sum([prod(s, q_) for s in all_sets]) == 1]
    
    obj = Minimize(sum((q[i] - q_[i])**2 for i in assignments))
    prob = Problem(obj, constraints)
    prob.solve()
    return q, q_

if __name__ == "__main__":
    q, q_ = counterexample_finder()
    print("Optimal q:", {i: float(q[i].value) for i in range(N)})
    print("Optimal q_:", {i: float(q_[i].value) for i in range(N)})